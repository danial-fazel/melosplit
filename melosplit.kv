<MyScreenManager>:
    LoginScreen:
    SignupScreen:
    GroupManagerScreen:
    AddGroupScreen:
    MemberInputsScreen:
    GroupScreen:
    AddExpenseScreen:

<LoginScreen>:
    name: "login"
    BoxLayout:
        orientation: 'vertical'
        padding: [20, 20]
        spacing: 15

        MDLabel:
            text: "Login"
            font_style: "H4"
            halign: "center"

        MDTextField:
            id: email_input
            hint_text: "Email"
            mode: "rectangle"

        MDTextField:
            id: password_input
            hint_text: "Password"
            password: True
            mode: "rectangle"

        MDRaisedButton:
            text: "Login"
            on_release: root.login()

        MDTextButton:
            text: "Don't have an account? Sign up here."
            on_release: app.root.current = "signup"

<SignupScreen>:
    name: "signup"
    BoxLayout:
        orientation: 'vertical'
        padding: [20, 20]
        spacing: 15

        MDLabel:
            text: "Sign Up"
            font_style: "H4"
            halign: "center"

        MDTextField:
            id: email_input
            hint_text: "Email"
            mode: "rectangle"

        MDTextField:
            id: password_input
            hint_text: "Password"
            password: True
            mode: "rectangle"

        MDRaisedButton:
            text: "Sign Up"
            on_release: root.signup()

        MDTextButton:
            text: "Already have an account? Login here."
            on_release: app.root.current = "login"


<GroupManagerScreen>:
    name: "group_manager"
    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 15

        MDLabel:
            text: "Group Manager"
            font_style: "H4"
            halign: "center"

        ScrollView:
            MDList:
                id: group_list

        MDRaisedButton:
            text: "Add Group"
            on_release: root.manager.current = "add_group_screen"

        MDRaisedButton:
            text: "Go to User Profile"
            on_release: root.manager.current = "user_profile"

<AddGroupScreen>:
    name: "add_group_screen"
    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 15

        MDLabel:
            text: "Add Group"
            font_style: "H4"
            halign: "center"

        MDTextField:
            id: group_name_input
            hint_text: "Group Name"
            mode: "rectangle"

        MDTextField:
            id: num_members_input
            hint_text: "Number of Members"
            input_filter: "int"
            mode: "rectangle"

        MDRaisedButton:
            text: "Next"
            on_release: root.next_step()

        MDRaisedButton:
            text: "Back"
            on_release: root.manager.current = "group_manager"

<MemberInputsScreen>:
    name: "member_inputs_screen"
    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 15

        ScrollView:
            MDList:
                id: member_inputs_list

        MDRaisedButton:
            text: "Submit"
            on_release: root.submit_group()

        MDRaisedButton:
            text: "Back"
            on_release: root.manager.current = "add_group_screen"

<MemberTemplate>:
    orientation: "horizontal"
    spacing: 10
    size_hint_y: None
    height: dp(56)

    MDTextField:
        id: member_name
        hint_text: "Member Name"
        mode: "rectangle"

    MDTextField:
        id: member_email
        hint_text: "Member Email (optional)"
        mode: "rectangle"



<GroupScreen>:
    name: "group_screen"
    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 15

        MDLabel:
            id: group_title
            text: "Group Screen"
            font_style: "H4"
            halign: "center"

        ScrollView:
            MDList:
                id: transactions_history

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: dp(56)
            spacing: 10

            MDRaisedButton:
                text: "Member Summary"
                on_release: app.root.current = "member_summary_screen"

            MDRaisedButton:
                text: "Add Expenses"
                on_release: app.root.current = "add_expense_screen"

            MDRaisedButton:
                text: "Settle Up"
                on_release: app.root.current = "settle_up_screen"

<TransactionHistoryWidget@BoxLayout>:
    orientation: "vertical"
    size_hint_y: None
    height: dp(80)
    padding: 10
    spacing: 5

    MDLabel:
        text: f"[b]Payer:[/b] {root.payer}"
        markup: True
        font_size: dp(14)

    MDLabel:
        text: f"[b]Participants:[/b] {root.participants}"
        markup: True
        font_size: dp(14)

    MDLabel:
        text: f"[b]Amount:[/b] {root.amount} USD"
        markup: True
        font_size: dp(14)

    MDLabel:
        text: f"[b]Description:[/b] {root.description}"
        markup: True
        font_size: dp(14)

    MDLabel:
        text: f"[b]Date:[/b] {root.date}"
        markup: True
        font_size: dp(12)

<AddExpenseScreen>:
    name: "add_expense_screen"

    MDBoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(10)

        MDTextField:
            id: payer_name
            hint_text: "Payer Name"

        MDTextField:
            id: amount
            hint_text: "Amount"
            input_filter: "float"

        MDTextField:
            id: split_type
            hint_text: "Split Type"
            on_focus: root.open_split_type_menu(self)

        MDTextField:
            id: category
            hint_text: "Category"
            on_focus: root.open_category_menu(self)

        MDRaisedButton:
            text: "Select Participants"
            on_release: root.open_participant_dialog()

        MDLabel:
            id: selected_participants_label
            text: "Selected Participants: None"
            halign: "center"

        MDTextField:
            id: description
            hint_text: "Description (Optional)"

        MDLabel:
            id: error_label
            text: ""
            color: 1, 0, 0, 1  # Red color for error messages
            halign: "center"

        MDRaisedButton:
            text: "Submit"
            on_release: root.add_expense()

        ScrollView:
            MDList:
                id: participant_list

        MDRaisedButton:
            text: "Back"
            on_release: app.root.current = "group_screen"
            
<ParticipantListItem>:
    uid: ""
    text: ""
    IconLeftWidget:
        id: checkbox
        icon: "checkbox-blank-outline"
        on_release: root.toggle_participant()

<ParticipantDialogContent>:
    ScrollView:
        MDList:
            id: participant_list

